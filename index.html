<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        #numeroContainer {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 5px solid #8B0000;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px;
        }
        #numero {
            font-size: 6em;
            font-weight: bold;
            color: #2c3e50;
        }
        #historial {
            margin-top: 10px;
            font-size: 1.2em;
        }
        #numerosContainer, #ultimosNumerosContainer {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            max-width: 500px;
            margin: 0 auto;
            padding: 10px;
        }
        #ultimosNumerosContainer {
            grid-template-columns: repeat(5, 1fr);
            margin-top: 10px;
        }
        .numeroCirculo {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #05102e;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.0em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .numeroCirculo.marcado {
            background-color: #e74c3c;
        }
        .ultimoNumeroCirculo {
            background-color: #e74c3c;
            font-size: 1.2em;
        }
        button {
            padding: 10px 20px;
            font-size: 1em;
            margin-top: 10px;
            cursor: pointer;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            min-width: 150px;
        }
        button:hover {
            background-color: #2980b9;
        }
        #verificarCartonContainer, #escanearCartonContainer {
            margin-top: 20px;
        }
        #mensajeVerificacionCarton, #mensajeEscaneo {
            margin-top: 30px;
            font-size: 1.0em;
            color: #2c3e50;
        }
        #video {
            width: 300px;
            height: auto;
            border: 2px solid #000;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div id="numeroContainer">
        <div id="numero">--</div>
    </div>

    <div id="botonesContainer">
        <button id="reiniciarBtn" onclick="reiniciarJuego()">Reiniciar Juego</button>
        <button id="startStopBtn" onclick="startStop()">Comenzar</button>
    </div>

    <div id="historial">
        <div id="numerosContainer"></div>
    </div>

    <div id="ultimosNumeros">
        <p>Últimos 5 números:</p>
        <div id="ultimosNumerosContainer"></div>
        <div id="estadoJuego"></div>
    </div>

    <div id="verificarCartonContainer">
        <input type="number" id="cartonVerificar" placeholder="Cartón" min="1">
        <button onclick="verificarCarton()">Verificar</button>
        <div id="mensajeVerificacionCarton"></div>
    </div>

    <div id="escanearCartonContainer">
        <button onclick="abrirCamara()">Escanear Cartón</button>
        <video id="video" autoplay></video>
        <canvas id="canvas" style="display:none;"></canvas>
        <div id="mensajeEscaneo"></div>
    </div>

    <script>
        let numerosSalidos = [];
        let numerosDisponibles = Array.from({length: 90}, (_, i) => i + 1);
        let intervalo;
        let enEjecucion = false;
        let juegoPausado = false;

        function abrirCamara() {
            const video = document.getElementById('video');
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    video.srcObject = stream;
                })
                .catch(error => {
                    console.error("Error al acceder a la cámara", error);
                    document.getElementById('mensajeEscaneo').textContent = "Error al acceder a la cámara.";
                });
        }

        function verificarCarton() {
            const numeroCarton = parseInt(document.getElementById('cartonVerificar').value);
            const mensajeVerificacionCarton = document.getElementById('mensajeVerificacionCarton');

            if (isNaN(numeroCarton) || numeroCarton < 1) {
                mensajeVerificacionCarton.textContent = "❌ Ingrese un número de cartón válido.";
                mensajeVerificacionCarton.style.color = "red";
                return;
            }

            const numerosCarton = generarNumerosAleatorios(); 
            const numerosFaltantes = numerosCarton.filter(num => !numerosSalidos.includes(num));

            if (numerosFaltantes.length === 0) {
                mensajeVerificacionCarton.textContent = `✅ ¡Bingo! Todos los números del cartón ${numeroCarton} han salido.`;
                mensajeVerificacionCarton.style.color = "green";

                if (window.speechSynthesis) {
                    const mensaje = new SpeechSynthesisUtterance(`Bingo. El cartón número ${numeroCarton} tiene bingo`);
                    mensaje.lang = 'es-ES';
                    window.speechSynthesis.speak(mensaje);
                }
            } else {
                mensajeVerificacionCarton.textContent = `❌ En el cartón ${numeroCarton} faltan los números: ${numerosFaltantes.join(', ')}.`;
                mensajeVerificacionCarton.style.color = "red";
            }

            document.getElementById('cartonVerificar').value = "";
        }

        function generarNumerosAleatorios() {
            let numeros = new Set();
            while (numeros.size < 15) {
                let num = Math.floor(Math.random() * 90) + 1;
                numeros.add(num);
            }
            return Array.from(numeros);
        }

        function escanearCarton() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            document.getElementById('mensajeEscaneo').textContent = "Escaneando...";

            setTimeout(() => {
                const numerosDetectados = generarNumerosAleatorios();
                const numerosFaltantes = numerosDetectados.filter(num => !numerosSalidos.includes(num));

                if (numerosFaltantes.length === 0) {
                    document.getElementById('mensajeEscaneo').textContent = "✅ ¡Bingo detectado!";
                    document.getElementById('mensajeEscaneo').style.color = "green";
                } else {
                    document.getElementById('mensajeEscaneo').textContent = `❌ Números faltantes: ${numerosFaltantes.join(', ')}`;
                    document.getElementById('mensajeEscaneo').style.color = "red";
                }
            }, 2000);
        }
    </script>
</body>
</html>
